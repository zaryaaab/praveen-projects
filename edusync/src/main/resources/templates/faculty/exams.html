<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
    <title>EduSync - Exam Management</title>
</head>
<body>
    <nav th:replace="~{layout :: nav}"></nav>
    
    <div class="main-content">
        <div class="container">
            <!-- Alert Messages -->
            <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
            
            <!-- Page Content -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Exam Management</h2>
                <a th:href="@{/faculty/exams/create}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Create New Exam
                </a>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Your Scheduled Exams</h5>
                </div>
                <div class="card-body">
                    <div th:if="${exams == null || exams.empty}">
                        <p class="text-muted">No exams scheduled yet. Click "Create New Exam" to schedule an exam.</p>
                    </div>
                    <div th:if="${exams != null && !exams.empty}" class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Course</th>
                                    <th>Date & Time</th>
                                    <th>Duration</th>
                                    <th>Location</th>
                                    <th>Type</th>
                                    <th>Total Marks</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="exam : ${exams}">
                                    <td th:text="${exam.examTitle}">Midterm Exam</td>
                                    <td th:text="${exam.course.courseName}">Database Systems</td>
                                    <td th:text="${#temporals.format(exam.examDate, 'MMM dd, yyyy HH:mm')}">Dec 15, 2023 09:00</td>
                                    <td th:text="${exam.examDuration}">120 minutes</td>
                                    <td th:text="${exam.location}">Room 101</td>
                                    <td>
                                        <span th:text="${exam.examType}" 
                                              th:class="${exam.examType == 'Final' ? 'badge bg-danger' : 
                                                        (exam.examType == 'Midterm' ? 'badge bg-warning text-dark' : 
                                                        (exam.examType == 'Quiz' ? 'badge bg-info text-dark' : 'badge bg-secondary'))}">
                                            Midterm
                                        </span>
                                    </td>
                                    <td th:text="${exam.totalMarks}">100</td>
                                    <td>
                                        <form th:action="@{'/faculty/exams/delete/' + ${exam.id}}" method="post" 
                                              onsubmit="return confirm('Are you sure you want to delete this exam?');">
                                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="row" th:if="${courses != null && !courses.empty}">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Upcoming Exams by Course</h5>
                        </div>
                        <div class="card-body">
                            <div class="accordion" id="courseExamAccordion">
                                <div th:each="course, courseStat : ${courses}" class="accordion-item">
                                    <h2 class="accordion-header" th:id="'heading-' + ${courseStat.index}">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                                th:data-bs-target="'#collapse-' + ${courseStat.index}" aria-expanded="false"
                                                th:aria-controls="'collapse-' + ${courseStat.index}">
                                            <span th:text="${course.courseName}">Database Systems</span>
                                            <span class="badge bg-primary ms-2" 
                                                  th:text="${course.courseCode}">CS101</span>
                                        </button>
                                    </h2>
                                    <div th:id="'collapse-' + ${courseStat.index}" class="accordion-collapse collapse"
                                         th:aria-labelledby="'heading-' + ${courseStat.index}" data-bs-parent="#courseExamAccordion">
                                        <div class="accordion-body">
                                            <div th:with="courseExams=${exams.?[course.id == __${course.id}__]}">
                                                <div th:if="${courseExams.empty}">
                                                    <p class="text-muted">No exams scheduled for this course.</p>
                                                </div>
                                                <ul th:if="${!courseExams.empty}" class="list-group">
                                                    <li th:each="exam : ${courseExams}" class="list-group-item">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <strong th:text="${exam.examTitle}">Midterm Exam</strong>
                                                                <span class="badge bg-secondary ms-2" 
                                                                      th:text="${exam.examType}">Midterm</span>
                                                            </div>
                                                            <span th:text="${#temporals.format(exam.examDate, 'MMM dd, yyyy')}">
                                                                Dec 15, 2023
                                                            </span>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">Quick Tips</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <i class="bi bi-check-circle text-success"></i>
                                    Plan exams well in advance to give students time to prepare.
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-check-circle text-success"></i>
                                    Include clear information about exam format in the title or during class.
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-check-circle text-success"></i>
                                    Avoid scheduling multiple exams on the same day for the same course.
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-check-circle text-success"></i>
                                    Specify the exam location clearly, including building and room number.
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-check-circle text-success"></i>
                                    Clearly communicate the total marks and weightage in the course syllabus.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer th:replace="~{layout :: footer}"></footer>
    
    <!-- Include Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</body>
</html> 
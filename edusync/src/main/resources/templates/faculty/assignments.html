<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
    <title>EduSync - Faculty Assignments</title>
</head>
<body>
    <nav th:replace="~{layout :: nav}"></nav>
    
    <div class="main-content">
        <div class="container">
            <!-- Alert Messages -->
            <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
            
            <!-- Page Content -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Manage Assignments</h2>
                <a th:href="@{/faculty/assignments/create}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Create New Assignment
                </a>
            </div>
            
            <!-- No Courses Message -->
            <div th:if="${courses == null || courses.isEmpty()}" class="alert alert-info">
                <i class="bi bi-info-circle"></i> You are not teaching any courses yet. Please contact the administrator to assign courses to you.
            </div>
            
            <!-- No Assignments Message -->
            <div th:if="${(courses != null && !courses.isEmpty()) && (assignments == null || assignments.isEmpty())}" class="alert alert-info">
                <i class="bi bi-info-circle"></i> You have not created any assignments yet. Click the "Create New Assignment" button to get started.
            </div>
            
            <!-- Assignments List -->
            <div th:if="${assignments != null && !assignments.isEmpty()}" class="card mb-4">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Your Assignments</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Course</th>
                                    <th>Due Date</th>
                                    <th>Total Marks</th>
                                    <th>Submissions</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="assignment : ${assignments}">
                                    <td th:text="${assignment.title}">Assignment Title</td>
                                    <td th:text="${assignment.course.courseName + ' (' + assignment.course.courseCode + ')'}">Course Name</td>
                                    <td th:text="${#temporals.format(assignment.dueDate, 'dd MMM yyyy')}">01-01-2023</td>
                                    <td th:text="${assignment.totalMarks}">100</td>
                                    <td>
                                        <span th:if="${submissionCounts != null && submissionCounts.containsKey(assignment.id)}" 
                                              class="badge bg-primary" 
                                              th:text="${submissionCounts.get(assignment.id)}">0</span>
                                        <span th:unless="${submissionCounts != null && submissionCounts.containsKey(assignment.id)}" 
                                              class="badge bg-secondary">0</span>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a th:href="@{/faculty/assignments/{id}(id=${assignment.id})}" class="btn btn-outline-primary">
                                                <i class="bi bi-eye"></i> View
                                            </a>
                                            <button type="button" class="btn btn-outline-danger" 
                                                    th:attr="data-bs-assignment-id=${assignment.id}, data-bs-assignment-title=${assignment.title}"
                                                    data-bs-toggle="modal" data-bs-target="#deleteAssignmentModal">
                                                <i class="bi bi-trash"></i> Delete
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Delete Assignment Confirmation Modal -->
            <div class="modal fade" id="deleteAssignmentModal" tabindex="-1" aria-labelledby="deleteAssignmentModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title" id="deleteAssignmentModalLabel">Confirm Delete</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete the assignment <span id="assignmentTitleToDelete">Assignment Title</span>?</p>
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle"></i> This action cannot be undone. All submissions for this assignment will be deleted as well.
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <form id="deleteAssignmentForm" method="post">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Back to Dashboard -->
            <div class="mt-4">
                <a th:href="@{/faculty/dashboard}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>
    
    <footer th:replace="~{layout :: footer}"></footer>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Delete Assignment Modal Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deleteAssignmentModal = document.getElementById('deleteAssignmentModal');
            if (deleteAssignmentModal) {
                deleteAssignmentModal.addEventListener('show.bs.modal', function(event) {
                    const button = event.relatedTarget;
                    const assignmentId = button.getAttribute('data-bs-assignment-id');
                    const assignmentTitle = button.getAttribute('data-bs-assignment-title');
                    
                    const assignmentTitleEl = document.getElementById('assignmentTitleToDelete');
                    const deleteForm = document.getElementById('deleteAssignmentForm');
                    
                    assignmentTitleEl.textContent = assignmentTitle;
                    deleteForm.action = '/faculty/assignments/' + assignmentId + '/delete';
                });
            }
        });
    </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
    <title>EduSync - My Courses</title>
</head>
<body>
    <nav th:replace="~{layout :: nav}"></nav>
    
    <div class="main-content">
        <div class="container">
            <!-- Alert Messages -->
            <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
            
            <!-- Page Content -->
            <h2 class="mb-4">My Courses</h2>
            
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Enrolled Courses</h5>
                            <a th:href="@{/student/available-courses}" class="btn btn-sm btn-light">
                                <i class="bi bi-search"></i> Browse Available Courses
                            </a>
                        </div>
                        <div class="card-body">
                            <div th:if="${courses == null || courses.isEmpty()}" class="text-center py-5">
                                <h5>You are not enrolled in any courses yet</h5>
                                <p class="text-muted">
                                    <a th:href="@{/student/available-courses}" class="btn btn-primary mt-2">
                                        <i class="bi bi-search"></i> Browse available courses to enroll
                                    </a>
                                </p>
                            </div>
                            
                            <div th:if="${courses != null && !courses.isEmpty()}" class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Course Code</th>
                                            <th>Course Name</th>
                                            <th>Instructor</th>
                                            <th>Credit Hours</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="course : ${courses}">
                                            <td th:text="${course.courseCode}">CS101</td>
                                            <td th:text="${course.courseName}">Introduction to Computer Science</td>
                                            <td>
                                                <span th:if="${course.faculty != null}" th:text="${course.faculty.user.fullName}">Prof. Smith</span>
                                                <span th:if="${course.faculty == null}">Not assigned</span>
                                            </td>
                                            <td th:text="${course.creditHours != null ? course.creditHours : 'N/A'}">3</td>
                                            <td>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <a href="#" class="btn btn-outline-primary">
                                                        <i class="bi bi-info-circle"></i> Details
                                                    </a>
                                                    <a th:href="@{/student/assignments}" class="btn btn-outline-warning">
                                                        <i class="bi bi-clipboard-check"></i> Assignments
                                                    </a>
                                                    <button type="button" class="btn btn-outline-danger" 
                                                            th:attr="data-bs-course-id=${course.id}, data-bs-course-name=${course.courseName}"
                                                            data-bs-toggle="modal" data-bs-target="#dropCourseModal">
                                                        <i class="bi bi-trash"></i> Drop
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Course Progress Section -->
            <div class="row" th:if="${courses != null && !courses.isEmpty()}">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">Course Progress</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3" th:each="course : ${courses}">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title" th:text="${course.courseName}">Introduction to Computer Science</h6>
                                            <p class="card-text small text-muted" th:text="${course.courseCode}">CS101</p>
                                            <div class="progress mb-3">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">75%</div>
                                            </div>
                                            <div class="d-flex justify-content-between small">
                                                <span>Completed: 12/16 units</span>
                                                <span>Grade: A-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Drop Course Confirmation Modal -->
            <div class="modal fade" id="dropCourseModal" tabindex="-1" aria-labelledby="dropCourseModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title" id="dropCourseModalLabel">Confirm Drop Course</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to drop <span id="courseNameToDrop">Course Name</span>?</p>
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle"></i> Dropping a course may have academic implications. Please consult with your advisor if you're unsure.
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <form id="dropCourseForm" method="post">
                                <button type="submit" class="btn btn-danger">Drop Course</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer th:replace="~{layout :: footer}"></footer>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Drop Course Modal Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropCourseModal = document.getElementById('dropCourseModal');
            if (dropCourseModal) {
                dropCourseModal.addEventListener('show.bs.modal', function(event) {
                    const button = event.relatedTarget;
                    const courseId = button.getAttribute('data-bs-course-id');
                    const courseName = button.getAttribute('data-bs-course-name');
                    
                    const courseNameEl = document.getElementById('courseNameToDrop');
                    const dropForm = document.getElementById('dropCourseForm');
                    
                    courseNameEl.textContent = courseName;
                    dropForm.action = '/student/drop/' + courseId;
                });
            }
        });
    </script>
</body>
</html> 
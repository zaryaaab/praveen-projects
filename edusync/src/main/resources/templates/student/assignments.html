<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
    <title>EduSync - My Assignments</title>
</head>
<body>
    <nav th:replace="~{layout :: nav}"></nav>
    
    <div class="main-content">
        <div class="container">
            <!-- Alert Messages -->
            <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
            
            <!-- Page Content -->
            <h2 class="mb-4">My Assignments</h2>
            
            <!-- Filter and Search -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Filter Assignments</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <select class="form-select" id="statusFilter">
                                <option value="all">All Assignments</option>
                                <option value="pending">Pending</option>
                                <option value="submitted">Submitted</option>
                                <option value="graded">Graded</option>
                                <option value="overdue">Overdue</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-2">
                            <select class="form-select" id="courseFilter">
                                <option value="all">All Courses</option>
                                <option th:each="course : ${student.courses}" 
                                        th:value="${course.id}" 
                                        th:text="${course.courseName + ' (' + course.courseCode + ')'}">
                                    Course Name (CS101)
                                </option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-2">
                            <div class="d-grid">
                                <button id="applyFilters" class="btn btn-primary">
                                    <i class="bi bi-filter"></i> Apply Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- No Assignments Message -->
            <div th:if="${assignments == null || assignments.isEmpty()}" class="alert alert-info">
                <i class="bi bi-info-circle"></i> You don't have any assignments yet.
            </div>
            
            <!-- Assignments -->
            <div th:if="${assignments != null && !assignments.isEmpty()}" class="row" id="assignmentsList">
                <div th:each="assignment : ${assignments}" class="col-md-6 mb-4 assignment-item"
                     th:attr="data-course-id=${assignment.course.id}, data-status=${assignmentStatusMap != null ? assignmentStatusMap.get(assignment.id) : 'pending'}">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center"
                             th:with="status=${assignmentStatusMap != null ? assignmentStatusMap.get(assignment.id) : 'pending'}"
                             th:classappend="${status == 'graded' ? 'bg-success text-white' : 
                                            (status == 'submitted' ? 'bg-primary text-white' : 
                                            (status == 'overdue' ? 'bg-danger text-white' : 'bg-warning'))}">
                            <h5 class="mb-0" th:text="${assignment.title}">Assignment Title</h5>
                            <span class="badge bg-light text-dark" th:text="${assignment.course.courseCode}">CS101</span>
                        </div>
                        <div class="card-body">
                            <p class="card-text" th:if="${assignment.description != null}" th:text="${assignment.description}">
                                Assignment description text goes here.
                            </p>
                            <p class="card-text" th:if="${assignment.description == null}">
                                <span class="text-muted">No description available.</span>
                            </p>
                            
                            <div class="mt-3">
                                <dl class="row mb-0">
                                    <dt class="col-sm-5">Due Date:</dt>
                                    <dd class="col-sm-7" th:text="${#temporals.format(assignment.dueDate, 'dd MMM yyyy')}">01-01-2023</dd>
                                    
                                    <dt class="col-sm-5">Total Marks:</dt>
                                    <dd class="col-sm-7" th:text="${assignment.totalMarks}">100</dd>
                                    
                                    <dt class="col-sm-5">Status:</dt>
                                    <dd class="col-sm-7" th:with="status=${assignmentStatusMap != null ? assignmentStatusMap.get(assignment.id) : 'pending'}">
                                        <span th:if="${status == 'graded'}" class="badge bg-success">Graded</span>
                                        <span th:if="${status == 'submitted'}" class="badge bg-primary">Submitted</span>
                                        <span th:if="${status == 'overdue'}" class="badge bg-danger">Overdue</span>
                                        <span th:if="${status == 'pending'}" class="badge bg-warning text-dark">Pending</span>
                                    </dd>
                                    
                                    <dt class="col-sm-5" th:if="${status == 'graded'}" th:with="submission=${submissionMap.get(assignment.id)}">
                                        Your Score:
                                    </dt>
                                    <dd class="col-sm-7" th:if="${status == 'graded'}" th:with="submission=${submissionMap.get(assignment.id)}">
                                        <span th:text="${submission.obtainedMarks + '/' + assignment.totalMarks}">85/100</span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                        <div class="card-footer">
                            <a th:href="@{/student/assignments/{id}(id=${assignment.id})}" class="btn btn-primary w-100">
                                <i class="bi bi-eye"></i> View Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer th:replace="~{layout :: footer}"></footer>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Assignment Filter Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusFilter = document.getElementById('statusFilter');
            const courseFilter = document.getElementById('courseFilter');
            const applyFiltersBtn = document.getElementById('applyFilters');
            const assignmentItems = document.querySelectorAll('.assignment-item');
            
            // Filter function
            function filterAssignments() {
                const statusValue = statusFilter.value;
                const courseValue = courseFilter.value;
                
                assignmentItems.forEach(item => {
                    const courseId = item.getAttribute('data-course-id');
                    const status = item.getAttribute('data-status');
                    
                    // Check if matches both filters
                    const matchesStatus = statusValue === 'all' || status === statusValue;
                    const matchesCourse = courseValue === 'all' || courseId === courseValue;
                    
                    // Show/hide based on filter match
                    if (matchesStatus && matchesCourse) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }
            
            // Apply filters on button click
            applyFiltersBtn.addEventListener('click', filterAssignments);
        });
    </script>
</body>
</html> 
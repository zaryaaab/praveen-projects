<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}">
    <title>EduSync - Course Timetable</title>
    <style>
        .timetable-cell {
            min-height: 100px;
            position: relative;
            vertical-align: top;
            padding: 0;
        }
        .schedule-item {
            border-radius: 4px;
            padding: 8px;
            margin: 4px;
            font-size: 0.85rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }
        .schedule-lecture {
            background-color: #cfe2ff;
            border-left: 4px solid #0d6efd;
        }
        .schedule-lab {
            background-color: #d1e7dd;
            border-left: 4px solid #198754;
        }
        .schedule-tutorial {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .schedule-discussion {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .schedule-office_hours {
            background-color: #e2e3e5;
            border-left: 4px solid #6c757d;
        }
        .schedule-conflict {
            border: 2px dashed #dc3545 !important;
        }
        .schedule-time {
            font-size: 0.75rem;
            font-weight: bold;
        }
        .schedule-location {
            font-size: 0.75rem;
            color: #6c757d;
        }
        .time-axis {
            width: 80px;
            font-weight: bold;
            background-color: #f8f9fa;
            text-align: center;
        }
        .week-day {
            font-weight: bold;
            background-color: #f8f9fa;
            text-align: center;
        }
        .today-column {
            background-color: rgba(13, 110, 253, 0.05);
        }
    </style>
</head>
<body>
    <nav th:replace="~{layout :: nav}"></nav>
    
    <div class="main-content">
        <div class="container">
            <!-- Alert Messages -->
            <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
            
            <!-- Page Content -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Course Timetable</h2>
                <div class="btn-group" role="group" aria-label="Timetable view options">
                    <a th:href="@{/student/timetable}" class="btn btn-outline-primary" th:classappend="${viewType == 'weekly' ? 'active' : ''}">
                        <i class="bi bi-calendar-week"></i> Weekly View
                    </a>
                    <a th:href="@{/student/timetable(view='daily')}" class="btn btn-outline-primary" th:classappend="${viewType == 'daily' ? 'active' : ''}">
                        <i class="bi bi-calendar-day"></i> Daily View
                    </a>
                </div>
            </div>
            
            <!-- Conflicts Warning -->
            <div th:if="${conflicts != null && !conflicts.empty}" class="alert alert-warning mb-4">
                <h5 class="alert-heading"><i class="bi bi-exclamation-triangle"></i> Schedule Conflicts Detected</h5>
                <p>Your schedule has the following conflicts. Please consider resolving them:</p>
                <ul>
                    <li th:each="conflict : ${conflicts}">
                        <strong th:text="${conflict.course.courseName}">Course Name</strong>
                        <span th:text="${conflict.dayOfWeek}">Monday</span> at 
                        <span th:text="${conflict.startTime}">10:00</span> - 
                        <span th:text="${conflict.endTime}">11:30</span> 
                        (<span th:text="${conflict.type}">LECTURE</span>)
                    </li>
                </ul>
            </div>
            
            <!-- No Schedules Message -->
            <div th:if="${allSchedules == null || allSchedules.empty}" class="alert alert-info mb-4">
                <i class="bi bi-info-circle"></i>
                You don't have any scheduled classes at this time.
            </div>
            
            <!-- Weekly View -->
            <div th:if="${viewType == 'weekly' && allSchedules != null && !allSchedules.empty}" class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Weekly Timetable</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th class="time-axis">Time</th>
                                    <th class="week-day" th:each="day : ${#arrays.toArray({'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY'})}"
                                        th:classappend="${day == currentDayOfWeekName} ? 'today-column' : ''">
                                        <span th:text="${day.substring(0, 3)}">MON</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Time slots from 8:00 to 18:00 -->
                                <tr th:each="hour : ${#numbers.sequence(8, 18)}">
                                    <td class="time-axis" th:text="${hour} + ':00'">8:00</td>
                                    
                                    <!-- For each day of the week (Monday to Friday) -->
                                    <td th:each="day : ${#arrays.toArray({'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY'})}" 
                                        class="timetable-cell"
                                        th:classappend="${day == currentDayOfWeekName} ? 'today-column' : ''">
                                        
                                        <!-- Display schedules for this day and hour -->
                                        <div th:each="schedule : ${schedulesByDay.get(dayOfWeekMap.get(day))}" 
                                             th:if="${schedule.startTime.hour == hour || 
                                                   (schedule.startTime.hour < hour && schedule.endTime.hour > hour) ||
                                                   (schedule.startTime.hour < hour && schedule.endTime.hour == hour && schedule.endTime.minute > 0)}"
                                             th:class="'schedule-item schedule-' + ${#strings.toLowerCase(schedule.type)}"
                                             th:classappend="${conflicts != null && conflicts.contains(schedule)} ? 'schedule-conflict' : ''">
                                            
                                            <div class="fw-bold" th:text="${schedule.course.courseName}">Course Name</div>
                                            <div class="schedule-time">
                                                <span th:text="${schedule.startTime}">10:00</span> - 
                                                <span th:text="${schedule.endTime}">11:30</span>
                                                <span class="badge bg-secondary ms-1" th:text="${schedule.type}">LECTURE</span>
                                            </div>
                                            <div class="schedule-location" th:text="${schedule.location}">Room 101</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Daily View -->
            <div th:if="${viewType == 'daily' && allSchedules != null && !allSchedules.empty}" class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Daily Schedules</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs mb-3" id="dayTabs" role="tablist">
                        <li class="nav-item" role="presentation" th:each="day : ${dayOfWeekMap.keySet()}">
                            <button class="nav-link" 
                                    th:id="${day.toLowerCase() + '-tab'}"
                                    th:classappend="${day == currentDayOfWeekName} ? 'active' : ''"
                                    data-bs-toggle="tab" 
                                    th:data-bs-target="${'#' + day.toLowerCase()}" 
                                    type="button" 
                                    role="tab" 
                                    th:aria-controls="${day.toLowerCase()}" 
                                    th:aria-selected="${day == currentDayOfWeekName}">
                                <span th:text="${day.substring(0, 3)}">MON</span>
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="dayTabContent">
                        <div th:each="day : ${dayOfWeekMap.keySet()}"
                             class="tab-pane fade" 
                             th:id="${day.toLowerCase()}" 
                             th:classappend="${day == currentDayOfWeekName} ? 'show active' : ''"
                             role="tabpanel" 
                             th:aria-labelledby="${day.toLowerCase() + '-tab'}">
                            
                            <div th:if="${schedulesByDay.get(dayOfWeekMap.get(day)) == null || schedulesByDay.get(dayOfWeekMap.get(day)).empty}"
                                 class="alert alert-info">
                                No classes scheduled on <span th:text="${day}">MONDAY</span>.
                            </div>
                            
                            <div class="list-group">
                                <div th:each="schedule : ${schedulesByDay.get(dayOfWeekMap.get(day))}"
                                     th:class="'list-group-item list-group-item-action schedule-' + ${#strings.toLowerCase(schedule.type)}"
                                     th:classappend="${conflicts != null && conflicts.contains(schedule)} ? 'schedule-conflict' : ''">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1" th:text="${schedule.course.courseName}">Course Name</h5>
                                        <span class="badge bg-secondary" th:text="${schedule.type}">LECTURE</span>
                                    </div>
                                    <div class="mb-1">
                                        <i class="bi bi-clock"></i> 
                                        <span th:text="${schedule.startTime}">10:00</span> - 
                                        <span th:text="${schedule.endTime}">11:30</span>
                                    </div>
                                    <div>
                                        <i class="bi bi-geo-alt"></i> 
                                        <span th:text="${schedule.location}">Room 101</span>
                                    </div>
                                    <div class="mt-2 small text-muted" th:if="${schedule.course.faculty != null}">
                                        Instructor: <span th:text="${schedule.course.faculty.user.fullName}">Professor Name</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Course Legend -->
            <div th:if="${allSchedules != null && !allSchedules.empty}" class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">My Courses</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div th:each="course : ${student.courses}" class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title" th:text="${course.courseName}">Course Name</h5>
                                    <h6 class="card-subtitle mb-2 text-muted" th:text="${course.courseCode}">CSCI101</h6>
                                    <p class="card-text small" th:if="${course.description != null}" th:text="${course.description}">
                                        Course description text goes here.
                                    </p>
                                    <div class="mt-2">
                                        <span class="badge bg-primary" th:if="${course.creditHours != null}">
                                            <span th:text="${course.creditHours}">3</span> Credit Hours
                                        </span>
                                        <span class="badge bg-secondary" th:if="${course.faculty != null}" th:text="${course.faculty.user.fullName}">
                                            Professor Name
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Calendar Export Option -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Calendar Options</h5>
                </div>
                <div class="card-body">
                    <p>Export your academic schedule to your preferred calendar application:</p>
                    <div class="btn-group">
                        <a href="#" class="btn btn-outline-primary disabled">
                            <i class="bi bi-calendar"></i> Export to iCal
                        </a>
                        <a href="#" class="btn btn-outline-success disabled">
                            <i class="bi bi-google"></i> Add to Google Calendar
                        </a>
                        <a href="#" class="btn btn-outline-info disabled">
                            <i class="bi bi-printer"></i> Print Timetable
                        </a>
                    </div>
                    <p class="text-muted mt-2 small">
                        <i class="bi bi-info-circle"></i>
                        Calendar export functionality will be available soon.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <footer th:replace="~{layout :: footer}"></footer>
    
    <!-- Add Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Initialize tabs -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof bootstrap !== 'undefined') {
                var tabElms = document.querySelectorAll('button[data-bs-toggle="tab"]');
                tabElms.forEach(function(tabEl) {
                    new bootstrap.Tab(tabEl);
                });
            }
        });
    </script>
</body>
</html> 
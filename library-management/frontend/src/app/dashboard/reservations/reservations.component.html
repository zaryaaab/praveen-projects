<div class="reservations-container">
    <div class="page-header">
      <h1 class="page-title">My Reservations</h1>
      <p class="page-subtitle">Manage your book reservations and borrowings</p>
    </div>
  
    <mat-tab-group>
      <mat-tab label="Active ({{activeReservations.length}})">
        <div class="tab-content">
          <mat-card class="reservation-card" *ngFor="let reservation of activeReservations">
            <mat-card-content>
              <div class="reservation-content">
                <div class="book-thumbnail">
                  <img [src]="reservation.book?.coverImageBase64" [alt]="reservation.book.title">
                </div>
                <div class="reservation-details">
                  <div class="reservation-header">
                    <h3 class="book-title">{{reservation.book.title}}</h3>
                    <div class="status-badge" [ngClass]="'status-' + reservation.status">
                      <mat-icon>{{getStatusInfo(reservation.status).icon}}</mat-icon>
                      <span>{{getStatusInfo(reservation.status).label}}</span>
                    </div>
                  </div>
                  <p class="book-author">{{reservation.book?.author}}</p>
  
                  <div class="reservation-dates">
                    <div class="date-item">
                      <p class="date-label">Borrowed Date</p>
                      <p class="date-value">{{reservation.approvalDate | date:'MMM d, y'}}</p>
                    </div>
                    <div class="date-item">
                      <p class="date-label">Due Date</p>
                      <p class="date-value">{{reservation.dueDate | date:'MMM d, y'}}</p>
                    </div>
                  </div>
  
                  <div class="reservation-actions">
                    <button mat-raised-button color="primary" (click)="handleReturnBook(reservation)">
                      Return Now
                    </button>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
  
      <mat-tab label="Pending ({{pendingReservations.length}})">
        <div class="tab-content">
          <mat-card class="reservation-card" *ngFor="let reservation of pendingReservations">
            <mat-card-content>
              <div class="reservation-content">
                <div class="book-thumbnail">
                  <img [src]="reservation.book?.coverImageBase64" [alt]="reservation.book.title">
                </div>
                <div class="reservation-details">
                  <div class="reservation-header">
                    <h3 class="book-title">{{reservation.book.title}}</h3>
                    <div class="status-badge" [ngClass]="'status-' + reservation.status">
                      <mat-icon>{{getStatusInfo(reservation.status).icon}}</mat-icon>
                      <span>{{reservation.status === 'pending' ? 'Waitlist Position: ' + reservation.waitlistPosition : getStatusInfo(reservation.status).label}}</span>
                    </div>
                  </div>
                  <p class="book-author">{{reservation.book.author}}</p>
  
                  <div class="reservation-dates">
                    <div class="date-item">
                      <p class="date-label">Request Date</p>
                      <p class="date-value">{{reservation.requestDate | date:'MMM d, y'}}</p>
                    </div>
                  </div>
  
                  <div class="reservation-actions">
                    <button mat-stroked-button color="warn" (click)="handleCancelReservation(reservation)">
                      <mat-icon>cancel</mat-icon>
                      Cancel Reservation
                    </button>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
  
      <mat-tab label="History ({{historyReservations.length}})">
        <div class="tab-content">
          <mat-card class="reservation-card" *ngFor="let reservation of historyReservations">
            <mat-card-content>
              <div class="reservation-content">
                <div class="book-thumbnail">
                  <img [src]="reservation.book?.coverImageBase64" [alt]="reservation.book.title">
                </div>
                <div class="reservation-details">
                  <div class="reservation-header">
                    <h3 class="book-title">{{reservation.book.title}}</h3>
                    <div class="status-badge" [ngClass]="'status-' + reservation.status">
                      <mat-icon>{{getStatusInfo(reservation.status).icon}}</mat-icon>
                      <span>{{getStatusInfo(reservation.status).label}}</span>
                    </div>
                  </div>
                  <p class="book-author">{{reservation.book?.author}}</p>
  
                  <div class="reservation-dates" *ngIf="reservation.status === 'completed'">
                    <div class="date-item">
                      <p class="date-label">Borrowed Date</p>
                      <p class="date-value">{{reservation.approvalDate | date:'MMM d, y'}}</p>
                    </div>
                    <div class="date-item">
                      <p class="date-label">Return Date</p>
                      <p class="date-value">{{reservation.returnDate | date:'MMM d, y'}}</p>
                    </div>
                  </div>
  
                  <div class="reservation-dates" *ngIf="reservation.status === 'cancelled'">
                    <div class="date-item">
                      <p class="date-label">Request Date</p>
                      <p class="date-value">{{reservation.requestDate | date:'MMM d, y'}}</p>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  
    <!-- Cancel Reservation Dialog -->
    <div *ngIf="cancelDialogOpen" class="dialog-backdrop">
      <mat-card class="dialog-card">
        <mat-card-header>
          <mat-card-title>Cancel Reservation</mat-card-title>
          <mat-card-subtitle>Are you sure you want to cancel your reservation for "{{selectedReservation?.book?.title}}"? This action cannot be undone.</mat-card-subtitle>
          <button mat-icon-button class="close-button" (click)="closeDialog()">
            <mat-icon>close</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
        <button mat-button (click)="closeDialog()">Keep Reservation</button>
        <button mat-raised-button color="warn" (click)="confirmCancelReservation()">Cancel Reservation</button>
        </mat-card-content>
      </mat-card>
      </div>
  </div>
  
  